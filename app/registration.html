<!--#set var="title" value="OptimizedHTML 5" -->
<!--#include virtual="./parts/header.html" -->
<div class="page page__bg page__bg-circle">

  <div class="page-profile-head">
    <a href="" class="page-head-btn-back">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="lucide lucide-chevron-left-icon lucide-chevron-left">
        <path d="m15 18-6-6 6-6" />
      </svg>Назад
    </a>

    <a href="" class="header__logo">
      <img src="./images/dist/logo.png" alt="">
    </a>
  </div>

  <div class="status" id="status"></div>
  <div class="profile-avatar">
    <img src="../images/dist/avatar-empty.png" alt="">
    <div class="percent" id="percent">0%</div>
    <input type="file" id="fileInput" accept="image/png,image/jpeg,image/jpg" />
  </div>
  <div class="form-btn-wrapper">
    <button class="page-head-btn-image-upload">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="lucide lucide-image-up-icon lucide-image-up">
        <path d="M10.3 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10l-3.1-3.1a2 2 0 0 0-2.814.014L6 21" />
        <path d="m14 19.5 3-3 3 3" />
        <path d="M17 22v-5.5" />
        <circle cx="9" cy="9" r="2" />
      </svg>
      </svg>Загрузить фото профиля
    </button>
  </div>
  <div class="form-wrapper">
    <form action="">
      <div class="field-wrapper">
        <label class="field-label">Имя</label>
        <input name="name" type="text" class="field">
      </div>

      <div class="field-wrapper">
        <label class="field-label">Селект</label>
        <select name="" id="" class="field">
          <option value="">1</option>
          <option value="">2</option>
          <option value="">3</option>
        </select>
      </div>

      <div class="field-wrapper">
        <label class="field-label">Текст ареа</label>
        <textarea name="" id=""></textarea>
      </div>

      <label class="field-label">Тариф</label>
      <div class="field-tarif">
        <div class="field-tarif-item active">Базовый</div>
        <div class="field-tarif-item">PRO</div>
        <div class="field-tarif-item">Премиум</div>
      </div>


      <button type="submit" class="form-btn">Зарегистрироваться</button>
    </form>
  </div>
</div>
<!--#include virtual="./parts/nav.html" -->
</div>

<!--#include virtual="./parts/footer.html" -->


<script>
  (function () {
    const btn = document.querySelector('.page-head-btn-image-upload');
    const input = document.getElementById('fileInput');
    const percent = document.getElementById('percent');
    const avatar = document.querySelector('.profile-avatar img');

    const MAX_SIZE = 5 * 1024 * 1024;
    const ALLOWED = ['image/jpeg', 'image/png'];
    let xhr = null;

    btn.addEventListener('click', (e) => {
      e.preventDefault();
      input.click();
    });

    input.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      input.value = '';

      if (!file) return;
      if (!ALLOWED.includes(file.type)) return;
      if (file.size > MAX_SIZE) return;

      uploadFile(file);
    });

    function uploadFile(file) {
      if (xhr) try { xhr.abort(); } catch (_) { }

      xhr = new XMLHttpRequest();
      xhr.open('POST', 'https://api.imgbb.com/1/upload?key=8f66eccef4fc4672d813e747b661132c', true);

      const form = new FormData();
      form.append('image', file);

      xhr.onloadstart = () => {
        percent.style.display = 'flex';
        percent.textContent = '';
      };

      xhr.upload.onprogress = (ev) => {
        if (!ev.lengthComputable) return;
        const pct = Math.round((ev.loaded / ev.total) * 100);

        percent.textContent = pct + '%';
      };

      xhr.onreadystatechange = () => {
        if (xhr.readyState !== 4) return;

        if (xhr.status >= 200 && xhr.status < 300) {
          const data = JSON.parse(xhr.responseText || '{}');
          if (data?.data?.display_url) avatar.src = data.data.display_url;
        }

        finish();
      };

      xhr.onerror = finish;
      xhr.onabort = finish;

      xhr.send(form);
    }

    function finish() {
      percent.style.display = 'none';
      percent.textContent = '';
      xhr = null;
    }
  })();
</script>